---
import Layout from "@/layouts/Layout.astro";
import Icon from "../components/Icon.astro";
---

<Layout
  title="Libro de Reclamaciones | Destino Perú Viajes"
  description="Libro de Reclamaciones Virtual. Envía tus quejas o reclamos conforme a ley."
  canonical="https://destinoperuviajes.com/libro-de-reclamaciones"
>
  <div class="bg-slate-900 pt-32 pb-12 sm:pt-40 sm:pb-16 lg:pt-48 lg:pb-24">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div class="max-w-2xl mx-auto text-center">
        <h1 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">
          Libro de Reclamaciones
        </h1>
        <p class="mt-4 text-lg leading-8 text-gray-300">
          Conforme a lo establecido en el Código de Protección y Defensa del
          Consumidor, ponemos a tu disposición este Libro de Reclamaciones
          Virtual.
        </p>
      </div>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-6 lg:px-8 py-16">
    <!-- Success Message (Hidden by default) -->
    <div
      id="success-message"
      class="hidden bg-white p-12 rounded-2xl shadow-soft border border-gray-100 text-center"
    >
      <div
        class="w-20 h-20 bg-green-100 text-brand-green rounded-full flex items-center justify-center mx-auto mb-6"
      >
        <Icon name="tick-circle" class="w-10 h-10" />
      </div>
      <h2 class="text-3xl font-bold text-slate-900 mb-4">
        ¡Formulario Enviado!
      </h2>
      <p class="text-gray-600 mb-8 max-w-lg mx-auto">
        Hemos registrado tu hoja de reclamación correctamente. Te hemos enviado
        una copia a tu correo electrónico.
      </p>
      <a
        href="/"
        class="inline-block rounded-md bg-brand-green px-6 py-3 text-center text-sm font-bold text-white shadow-sm hover:bg-green-700 transition-all duration-300"
      >
        Volver al Inicio
      </a>
    </div>

    <form
      id="claims-form"
      action="https://formspree.io/f/PLACEHOLDER"
      method="POST"
      enctype="multipart/form-data"
      class="space-y-12 bg-white p-8 md:p-12 rounded-2xl shadow-soft border border-gray-100"
    >
      <!-- 1. Identificación del Consumidor -->
      <div class="space-y-6">
        <h2 class="text-xl font-bold text-slate-900 border-b pb-2">
          1. Identificación del Consumidor
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              for="tipo_documento"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Tipo de Documento</label
            >
            <div class="mt-2">
              <select
                id="tipo_documento"
                name="tipo_documento"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                required
              >
                <option value="DNI">DNI</option>
                <option value="CE">Carné de Extranjería</option>
                <option value="Pasaporte">Pasaporte</option>
                <option value="Otros">Otros</option>
              </select>
            </div>
          </div>

          <div>
            <label
              for="numero_documento"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Número de Documento</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="numero_documento"
                id="numero_documento"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                required
              />
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              for="nombres"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Nombres</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="nombres"
                id="nombres"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                required
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label
                for="apellido_paterno"
                class="block text-sm font-medium leading-6 text-slate-900"
                >Primer Apellido</label
              >
              <div class="mt-2">
                <input
                  type="text"
                  name="apellido_paterno"
                  id="apellido_paterno"
                  class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                  required
                />
              </div>
            </div>
            <div>
              <label
                for="apellido_materno"
                class="block text-sm font-medium leading-6 text-slate-900"
                >Segundo Apellido</label
              >
              <div class="mt-2">
                <input
                  type="text"
                  name="apellido_materno"
                  id="apellido_materno"
                  class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                  required
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. Identificación de la Empresa Contratante -->
      <div class="space-y-6">
        <h2 class="text-xl font-bold text-slate-900 border-b pb-2">
          2. Identificación de la Empresa
        </h2>

        <div>
          <label class="text-sm font-medium leading-6 text-slate-900 block mb-2"
            >¿Representa a una empresa / agencia?</label
          >
          <div class="flex gap-4">
            <div class="flex items-center">
              <input
                id="empresa-si"
                name="es_empresa"
                type="radio"
                value="si"
                class="h-4 w-4 border-gray-300 text-brand-green focus:ring-brand-green"
              />
              <label
                for="empresa-si"
                class="ml-3 block text-sm font-medium leading-6 text-slate-900"
                >Sí</label
              >
            </div>
            <div class="flex items-center">
              <input
                id="empresa-no"
                name="es_empresa"
                type="radio"
                value="no"
                class="h-4 w-4 border-gray-300 text-brand-green focus:ring-brand-green"
                checked
              />
              <label
                for="empresa-no"
                class="ml-3 block text-sm font-medium leading-6 text-slate-900"
                >No</label
              >
            </div>
          </div>
        </div>

        <div
          id="datos-empresa"
          class="grid grid-cols-1 md:grid-cols-2 gap-6 transition-all duration-300 opacity-50 pointer-events-none"
        >
          <div>
            <label
              for="razon_social"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Razón Social</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="razon_social"
                id="razon_social"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                disabled
              />
            </div>
          </div>

          <div>
            <label
              for="ruc"
              class="block text-sm font-medium leading-6 text-slate-900"
              >RUC</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="ruc"
                id="ruc"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                disabled
              />
            </div>
          </div>
        </div>
      </div>

      <!-- 3. Contacto -->
      <div class="space-y-6">
        <h2 class="text-xl font-bold text-slate-900 border-b pb-2">
          3. Datos de Contacto
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              for="email"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Correo Electrónico</label
            >
            <div class="mt-2">
              <input
                type="email"
                name="email"
                id="email"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                required
              />
            </div>
          </div>

          <div>
            <label
              for="celular"
              class="block text-sm font-medium leading-6 text-slate-900"
              >Celular</label
            >
            <div class="mt-2">
              <input
                type="tel"
                name="celular"
                id="celular"
                class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
                required
              />
            </div>
          </div>
        </div>
      </div>

      <!-- 4. Detalle de la Reclamación -->
      <div class="space-y-6">
        <h2 class="text-xl font-bold text-slate-900 border-b pb-2">
          4. Detalle de la Reclamación y Pedido
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="space-y-4">
            <div
              class="flex items-start gap-4 p-4 border rounded-lg bg-gray-50 border-gray-100"
            >
              <div class="flex items-center h-6">
                <input
                  id="queja"
                  name="tipo_reclamo"
                  type="radio"
                  value="Queja"
                  class="h-4 w-4 border-gray-300 text-brand-green focus:ring-brand-green"
                  required
                />
              </div>
              <div class="text-sm leading-6">
                <label for="queja" class="font-medium text-slate-900"
                  >Queja</label
                >
                <p class="text-gray-500">
                  Disconformidad no relacionada a los productos o servicios; o,
                  malestar o descontento respecto a la atención al público.
                </p>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <div
              class="flex items-start gap-4 p-4 border rounded-lg bg-gray-50 border-gray-100"
            >
              <div class="flex items-center h-6">
                <input
                  id="reclamo"
                  name="tipo_reclamo"
                  type="radio"
                  value="Reclamo"
                  class="h-4 w-4 border-gray-300 text-brand-green focus:ring-brand-green"
                  required
                />
              </div>
              <div class="text-sm leading-6">
                <label for="reclamo" class="font-medium text-slate-900"
                  >Reclamo</label
                >
                <p class="text-gray-500">
                  Disconformidad relacionada a los productos o servicios.
                </p>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label
            for="fecha_incidente"
            class="block text-sm font-medium leading-6 text-slate-900"
            >Fecha del Incidente</label
          >
          <div class="mt-2">
            <input
              type="date"
              name="fecha_incidente"
              id="fecha_incidente"
              class="block w-full md:w-1/3 rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
              required
            />
          </div>
        </div>

        <div>
          <label
            for="detalle"
            class="block text-sm font-medium leading-6 text-slate-900"
            >Detalle del Reclamo o Queja</label
          >
          <div class="mt-2">
            <textarea
              id="detalle"
              name="detalle"
              rows="4"
              class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
              required></textarea>
          </div>
        </div>

        <div>
          <label
            for="pedido"
            class="block text-sm font-medium leading-6 text-slate-900"
            >Pedido Concreto</label
          >
          <div class="mt-2">
            <textarea
              id="pedido"
              name="pedido"
              rows="3"
              class="block w-full rounded-md border-0 py-1.5 text-slate-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-brand-green sm:text-sm sm:leading-6 px-3"
              required></textarea>
          </div>
        </div>

        <div>
          <label
            for="archivo"
            class="block text-sm font-medium leading-6 text-slate-900"
            >Adjuntar Archivo (Opcional)</label
          >
          <div class="mt-2">
            <input
              type="file"
              name="archivo"
              id="archivo"
              accept=".jpg,.jpeg,.png,.pdf,.doc,.docx"
              class="block w-full text-sm text-slate-500
                file:mr-4 file:py-2 file:px-4
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-brand-green/10 file:text-brand-green
                hover:file:bg-brand-green/20"
            />
            <p class="mt-2 text-xs text-gray-500">
              Formatos permitidos: PDF, JPG, PNG, DOC. Tamaño máximo: 1MB.
            </p>
          </div>
        </div>
      </div>

      <div class="pt-6">
        <button
          type="submit"
          class="w-full rounded-md bg-brand-red px-3.5 py-4 text-center text-sm font-bold text-white shadow-sm hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 uppercase tracking-widest transition-all duration-300"
        >
          Enviar Hoja de Reclamación
        </button>
      </div>
    </form>

    <div
      id="success-message"
      class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative"
      role="alert"
    >
      <strong class="font-bold">¡Éxito!</strong>
      <span class="block sm:inline"
        >Tu hoja de reclamación ha sido enviada correctamente.</span
      >
      <p class="mt-2 text-sm">
        Nos pondremos en contacto contigo a la brevedad posible.
      </p>
    </div>
  </div>
</Layout>

<script>
  const radioSi = document.getElementById("empresa-si") as HTMLInputElement;
  const radioNo = document.getElementById("empresa-no") as HTMLInputElement;
  const datosEmpresa = document.getElementById("datos-empresa");
  const inputsEmpresa = datosEmpresa?.querySelectorAll("input");
  const form = document.getElementById("claims-form") as HTMLFormElement;
  const successMessage = document.getElementById("success-message");
  const fileInput = document.getElementById("archivo") as HTMLInputElement;

  function toggleEmpresa() {
    if (!datosEmpresa) return;

    if (radioSi.checked) {
      datosEmpresa.classList.remove("opacity-50", "pointer-events-none");
      inputsEmpresa?.forEach((input) => {
        input.disabled = false;
        input.required = true;
      });
    } else {
      datosEmpresa.classList.add("opacity-50", "pointer-events-none");
      inputsEmpresa?.forEach((input) => {
        input.disabled = true;
        input.required = false;
        input.value = "";
      });
    }
  }

  radioSi?.addEventListener("change", toggleEmpresa);
  radioNo?.addEventListener("change", toggleEmpresa);

  // Validate File Size (Max 1MB)
  fileInput?.addEventListener("change", function () {
    const file = this.files?.[0];
    if (file) {
      const maxSize = 1024 * 1024; // 1MB in bytes
      if (file.size > maxSize) {
        alert(
          "El archivo es demasiado grande. El tamaño máximo permitido es 1MB."
        );
        this.value = ""; // Clear input
      }
    }
  });

  // Handle AJAX Submission
  form?.addEventListener("submit", async function (e) {
    e.preventDefault();

    const submitBtn = form.querySelector(
      'button[type="submit"]'
    ) as HTMLButtonElement;
    const originalBtnText = submitBtn.innerText;

    submitBtn.disabled = true;
    submitBtn.innerText = "ENVIANDO...";

    try {
      const formData = new FormData(form);
      const response = await fetch(form.action, {
        method: "POST",
        body: formData,
        headers: {
          Accept: "application/json",
        },
      });

      if (response.ok) {
        form.classList.add("hidden");
        successMessage?.classList.remove("hidden");
        window.scrollTo(0, 0); // Scroll to top to see message
      } else {
        const data = await response.json();
        if (Object.hasOwn(data, "errors")) {
          alert(
            "Error: " +
              data["errors"]
                .map((error: { message: string }) => error["message"])
                .join(", ")
          );
        } else {
          alert(
            "Hubo un problema al enviar el formulario. Por favor intenta nuevamente."
          );
        }
        submitBtn.disabled = false;
        submitBtn.innerText = originalBtnText;
      }
    } catch (error) {
      console.error("Error:", error);
      alert(
        "Hubo un error de conexión. Por favor verifica tu internet e intenta nuevamente."
      );
      submitBtn.disabled = false;
      submitBtn.innerText = originalBtnText;
    }
  });
</script>
