---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Icon from "@/components/Icon.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const tours = await getCollection("tours");
  return tours.map((tour) => ({
    params: { id: tour.slug },
    props: { tour },
  }));
}

const { tour } = Astro.props;
const { Content } = await tour.render();
const {
  title,
  description,
  image,
  duration,
  location,
  meta_title,
  meta_description,
} = tour.data;

const canonical = `https://destinoperuviajes.com/tours/${tour.slug}`;
---

<Layout title={meta_title} description={meta_description} canonical={canonical}>
  <!-- Hero Section -->
  <div class="relative h-[60vh] lg:h-[70vh] w-full overflow-hidden">
    <Image
      src={image}
      alt={title}
      class="w-full h-full object-cover"
      width={1920}
      height={1080}
      loading="eager"
      decoding="async"
      fetchpriority="high"
      widths={[375, 768, 1280, 1920]}
      sizes="100vw"
      quality={70}
    />
    <div
      class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent"
    >
    </div>

    <div class="absolute bottom-0 left-0 w-full p-6 md:p-12 lg:p-20">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-wrap gap-3 mb-6">
          <span
            class="px-4 py-1.5 bg-brand-red/90 text-white text-sm font-bold rounded-full backdrop-blur-sm uppercase tracking-wider"
          >
            {duration}
          </span>
        </div>
        <h1
          class="text-4xl md:text-6xl lg:text-7xl font-black text-white mb-6 leading-tight"
        >
          {title}
        </h1>
        <p
          class="text-lg md:text-xl text-white/90 font-medium max-w-2xl mb-8 leading-relaxed"
        >
          {description}
        </p>
        <div
          class="flex flex-wrap items-center gap-6 text-white/90 font-medium text-lg"
        >
          <div class="flex items-center gap-2">
            <Icon name="location" class="w-6 h-6 text-brand-red" />
            {location}
          </div>
          <div class="flex items-center gap-2">
            <Icon name="clock" class="w-6 h-6 text-brand-red" />
            {duration}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 lg:py-16">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20">
      <!-- Left Column: Content -->
      <div class="lg:col-span-8">
        <div
          class="prose prose-lg prose-slate max-w-none
          prose-headings:font-bold prose-headings:text-slate-900
          prose-p:text-slate-600 prose-p:leading-relaxed
          prose-li:text-slate-600
          prose-strong:text-slate-900 prose-strong:font-bold
          prose-img:rounded-2xl prose-img:shadow-lg"
        >
          <Content />
        </div>
      </div>

      <!-- Right Column: Sidebar -->
      <div class="lg:col-span-4">
        <div class="sticky top-24 space-y-8">
          <!-- Booking Card -->
          <div
            class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-8 border border-slate-100"
          >
            <h3 class="text-2xl font-bold text-slate-900 mb-2">
              ¿Te interesa este tour?
            </h3>
            <p class="text-slate-500 mb-8">
              Contáctanos para personalizar tu experiencia y obtener una
              cotización.
            </p>

            <div class="space-y-4">
              <a
                href="https://api.whatsapp.com/send?phone=51979758781"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Chatea con nosotros por WhatsApp"
                class="flex items-center justify-center gap-3 w-full py-4 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl transition-all duration-300 shadow-lg shadow-green-500/25 hover:-translate-y-1"
              >
                <Icon name="whatsapp" class="w-6 h-6" />
                Consultar por WhatsApp
              </a>
              <a
                href="mailto:infodestinoperuviajes@gmail.com"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Envianos un correo"
                class="flex items-center justify-center gap-3 w-full py-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl transition-all duration-300 shadow-lg shadow-slate-900/25 hover:-translate-y-1"
              >
                <Icon name="sms" class="w-6 h-6" />
                Enviar Correo
              </a>
            </div>
          </div>

          <!-- Need Help? -->
          <div class="bg-slate-50 rounded-3xl p-8 border border-slate-100">
            <div class="flex items-center gap-4 mb-4">
              <div
                class="w-12 h-12 bg-brand-red/80 rounded-full flex items-center justify-center"
              >
                <Icon name="call-calling" class="w-6 h-6" />
              </div>
              <div>
                <p class="text-sm text-slate-500 font-bold uppercase">
                  ¿Necesitas ayuda?
                </p>
                <p class="text-lg font-bold text-slate-900">+51 979 758 781</p>
              </div>
            </div>
            <p class="text-slate-500 text-sm">
              Nuestro equipo de expertos está disponible 24/7 para ayudarte a
              planificar tu viaje perfecto.
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>
